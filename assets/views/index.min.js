!function(){"use strict";app=app||{},app.showView=function(a){console.log("showView: "),console.dir(a.el),void 0!=app.views.current&&$(app.views.current.el).hide(),app.views.current=a,$(app.views.current.el).show()},app.Project=Backbone.Model.extend({idAttribute:"_id",defaults:{_id:void 0,name:"",slogan:"",company:"",companySlogan:"",copyrightYear:""},url:function(){return"/admin/accounts/"+(this.isNew()?"":this.id+"/")}}),app.Record=Backbone.Model.extend({idAttribute:"_id",defaults:{_id:void 0,"name.full":"",company:"",phone:"",zip:"",status:{id:void 0,name:"",userCreated:{}},userCreated:{}},url:function(){return"/admin/accounts/"+(this.isNew()?"":this.id+"/")}}),app.RecordCollection=Backbone.Collection.extend({model:app.Record,url:"/admin/accounts/",parse:function(a){return app.pagingView.model.set({pages:a.pages,items:a.items}),app.filterView.model.set(a.filters),a.data}}),app.Filter=Backbone.Model.extend({defaults:{search:"",status:"",sort:"",limit:""}}),app.Paging=Backbone.Model.extend({defaults:{pages:{},items:{}}}),app.HeaderView=Backbone.View.extend({el:".navbar",events:{"click #gotoHome":"processHome","click #gotoAbout":"processAbout","click #gotoContact":"processContact","click #gotoSignup":"processSignup","click #gotoLogin":"processLogin"},initialize:function(){},processHome:function(a){a.preventDefault(),console.log("view: #gotoHome clicked"),app.showView(app.views.homeView)},processAbout:function(a){a.preventDefault(),console.log("view: #gotoAbout clicked"),app.showView(app.views.aboutView)},processContact:function(a){a.preventDefault(),console.log("view: #gotoContact clicked"),app.showView(app.views.contactView)},processSignup:function(a){a.preventDefault(),console.log("view: #gotoSignup clicked"),app.showView(app.views.signupView)},processLogin:function(a){a.preventDefault(),console.log("view: gotoLogin clicked"),app.showView(app.views.loginView)}}),app.HomeView=Backbone.View.extend({el:"#home",template:_.template(JST["assets/views/home/tmpl-home.html"]()),initialize:function(){console.log("homeView loaded."),this.render()},render:function(){return this.$el.html(this.template("hello")),this}}),app.AboutView=Backbone.View.extend({el:"#about",template:_.template(JST["assets/views/about/tmpl-about.html"]()),initialize:function(){console.log("aboutView loaded."),this.render()},render:function(){return this.$el.html(this.template("hello")),this}}),app.ContactView=Backbone.View.extend({el:"#contact",template:_.template(JST["assets/views/contact/tmpl-contact.html"]()),initialize:function(){console.log("contactView loaded."),this.render()},render:function(){return this.$el.html(this.template("hello")),this}}),app.LoginView=Backbone.View.extend({el:"#login",template:_.template(JST["assets/views/login/tmpl-login.html"]()),initialize:function(){console.log("loginView loaded."),this.render()},render:function(){return this.$el.html(this.template("hello")),this}}),app.SignupView=Backbone.View.extend({el:"#signup",template:_.template(JST["assets/views/signup/tmpl-signup.html"]()),initialize:function(){console.log("signupView loaded."),this.render()},render:function(){return this.$el.html(this.template("hello")),this}}),app.ResultsView=Backbone.View.extend({el:"#results-table",initialize:function(){this.collection=new app.RecordCollection(app.mainView.results.data),this.listenTo(this.collection,"reset",this.render),this.render()},render:function(){this.$el.html(this.template());var a=document.createDocumentFragment();this.collection.each(function(b){var c=new app.ResultsRowView({model:b});a.appendChild(c.render().el)},this),$("#results-rows").append(a),0===this.collection.length&&$("#results-rows").append($("#tmpl-results-empty-row").html())}}),app.ResultsRowView=Backbone.View.extend({tagName:"tr",events:{"click .btn-details":"viewDetails"},viewDetails:function(){location.href=this.model.url()},render:function(){return this.$el.html(this.template(this.model.attributes)),this.$el.find(".timeago").each(function(a,b){if(b.innerText){var c=moment(b.innerText);b.innerText=c.from(),b.getAttribute("data-age")&&(b.innerText=b.innerText.replace("ago","old"))}}),this}}),app.FilterView=Backbone.View.extend({el:"#filters",events:{"submit form":"preventSubmit",'keypress input[type="text"]':"filterOnEnter","change select":"filter"},initialize:function(){this.model=new app.Filter(app.mainView.results.filters),this.listenTo(this.model,"change",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes));for(var a in this.model.attributes)this.model.attributes.hasOwnProperty(a)&&this.$el.find('[name="'+a+'"]').val(this.model.attributes[a])},preventSubmit:function(a){a.preventDefault()},filterOnEnter:function(a){13===a.keyCode&&this.filter()},filter:function(){var a=$("#filters form").serialize();Backbone.history.navigate("q/"+a,{trigger:!0})}}),app.PagingView=Backbone.View.extend({el:"#results-paging",events:{"click .btn-page":"goToPage"},initialize:function(){this.model=new app.Paging({pages:app.mainView.results.pages,items:app.mainView.results.items}),this.listenTo(this.model,"change",this.render),this.render()},render:function(){this.model.get("pages").total>1?(this.$el.html(this.template(this.model.attributes)),this.model.get("pages").hasPrev||this.$el.find(".btn-prev").attr("disabled","disabled"),this.model.get("pages").hasNext||this.$el.find(".btn-next").attr("disabled","disabled")):this.$el.empty()},goToPage:function(a){var b=$("#filters form").serialize()+"&page="+$(a.target).data("page");Backbone.history.navigate("q/"+b,{trigger:!0}),$("body").scrollTop(0)}}),window.onload=function(){console.log("app loading..."),app.firstLoad=!0,app.views={},app.views.headerView=new app.HeaderView,app.views.homeView=new app.HomeView,app.views.current=app.views.homeView,app.views.aboutView=new app.AboutView,app.views.contactView=new app.ContactView,app.views.signupView=new app.SignupView,app.views.loginView=new app.LoginView,console.log("app loaded!")}}();