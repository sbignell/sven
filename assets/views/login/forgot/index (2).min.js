"use strict";exports.init=function(a,b){a.isAuthenticated()?b.redirect(a.user.defaultReturnUrl()):b.render("login/forgot/index")},exports.send=function(a,b,c){var d=a.app.utility.workflow(a,b);d.on("validate",function(){return a.body.email?void d.emit("generateToken"):(d.outcome.errfor.email="required",d.emit("response"))}),d.on("generateToken",function(){var b=require("crypto");b.randomBytes(21,function(b,e){if(b)return c(b);var f=e.toString("hex");a.app.db.models.User.encryptPassword(f,function(a,b){return a?c(a):void d.emit("patchUser",f,b)})})}),d.on("patchUser",function(b,c){var e={email:a.body.email.toLowerCase()},f={resetPasswordToken:c,resetPasswordExpires:Date.now()+1e7};a.app.db.models.User.findOneAndUpdate(e,f,function(a,c){return a?d.emit("exception",a):c?void d.emit("sendEmail",b,c):d.emit("response")})}),d.on("sendEmail",function(c,e){a.app.utility.sendmail(a,b,{from:a.app.config.smtp.from.name+" <"+a.app.config.smtp.from.address+">",to:e.email,subject:"Reset your "+a.app.config.projectName+" password",textPath:"login/forgot/email-text",htmlPath:"login/forgot/email-html",locals:{username:e.username,resetLink:a.protocol+"://"+a.headers.host+"/login/reset/"+e.email+"/"+c+"/",projectName:a.app.config.projectName},success:function(){d.emit("response")},error:function(a){d.outcome.errors.push("Error Sending: "+a),d.emit("response")}})}),d.emit("validate")};
//# sourceMappingURL=index%20(2).min.js.map