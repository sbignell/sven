"use strict";exports.find=function(a,b,c){a.query.pivot=a.query.pivot?a.query.pivot:"",a.query.name=a.query.name?a.query.name:"",a.query.limit=a.query.limit?parseInt(a.query.limit,null):20,a.query.page=a.query.page?parseInt(a.query.page,null):1,a.query.sort=a.query.sort?a.query.sort:"_id";var d={};a.query.pivot&&(d.pivot=new RegExp("^.*?"+a.query.pivot+".*$","i")),a.query.name&&(d.name=new RegExp("^.*?"+a.query.name+".*$","i")),a.app.db.models.Category.pagedFind({filters:d,keys:"pivot name",limit:a.query.limit,page:a.query.page,sort:a.query.sort},function(d,e){return d?c(d):void(a.xhr?(b.header("Cache-Control","no-cache, no-store, must-revalidate"),e.filters=a.query,b.send(e)):(e.filters=a.query,b.render("admin/categories/index",{data:{results:escape(JSON.stringify(e))}})))})},exports.read=function(a,b,c){a.app.db.models.Category.findById(a.params.id).exec(function(d,e){return d?c(d):void(a.xhr?b.send(e):b.render("admin/categories/details",{data:{record:escape(JSON.stringify(e))}}))})},exports.create=function(a,b){var c=a.app.utility.workflow(a,b);c.on("validate",function(){return a.user.roles.admin.isMemberOf("root")?a.body.pivot?a.body.name?void c.emit("duplicateCategoryCheck"):(c.outcome.errors.push("A name is required."),c.emit("response")):(c.outcome.errors.push("A pivot is required."),c.emit("response")):(c.outcome.errors.push("You may not create categories."),c.emit("response"))}),c.on("duplicateCategoryCheck",function(){a.app.db.models.Category.findById(a.app.utility.slugify(a.body.pivot+" "+a.body.name)).exec(function(a,b){return a?c.emit("exception",a):b?(c.outcome.errors.push("That category+pivot is already taken."),c.emit("response")):void c.emit("createCategory")})}),c.on("createCategory",function(){var b={_id:a.app.utility.slugify(a.body.pivot+" "+a.body.name),pivot:a.body.pivot,name:a.body.name};a.app.db.models.Category.create(b,function(a,b){return a?c.emit("exception",a):(c.outcome.record=b,c.emit("response"))})}),c.emit("validate")},exports.update=function(a,b){var c=a.app.utility.workflow(a,b);c.on("validate",function(){return a.user.roles.admin.isMemberOf("root")?a.body.pivot?a.body.name?void c.emit("patchCategory"):(c.outcome.errfor.name="required",c.emit("response")):(c.outcome.errfor.pivot="pivot",c.emit("response")):(c.outcome.errors.push("You may not update categories."),c.emit("response"))}),c.on("patchCategory",function(){var b={pivot:a.body.pivot,name:a.body.name};a.app.db.models.Category.findByIdAndUpdate(a.params.id,b,function(a,b){return a?c.emit("exception",a):(c.outcome.category=b,c.emit("response"))})}),c.emit("validate")},exports["delete"]=function(a,b){var c=a.app.utility.workflow(a,b);c.on("validate",function(){return a.user.roles.admin.isMemberOf("root")?void c.emit("deleteCategory"):(c.outcome.errors.push("You may not delete categories."),c.emit("response"))}),c.on("deleteCategory",function(){a.app.db.models.Category.findByIdAndRemove(a.params.id,function(a){return a?c.emit("exception",a):void c.emit("response")})}),c.emit("validate")};
//# sourceMappingURL=index%20(2).min.js.map